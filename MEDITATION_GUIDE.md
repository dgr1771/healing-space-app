# 冥想引导音频功能说明

## 已完成功能

### 1. 预设冥想引导音频 ✅

**服务位置**：`src/services/meditationAudioService.ts`

**可用的预设引导**：

#### 呼吸练习引导
- **呼吸练习引导（5分钟）** - 深呼吸放松，4-7-8呼吸法
- **呼吸练习引导（10分钟）** - 深呼吸放松，平静内心

#### 正念冥想引导
- **正念冥想引导（10分钟）** - 专注当下，清空思绪
- **正念冥想引导（15分钟）** - 深度放松，回归内心

#### 身体扫描冥想
- **身体扫描冥想（15分钟）** - 从头到脚放松身体各部位
- **身体扫描冥想（20分钟）** - 深度身体放松，释放压力

#### 助眠冥想引导
- **助眠冥想引导（20分钟）** - 放松身心，安然入睡
- **助眠冥想引导（30分钟）** - 深度放松，进入甜美梦乡

**音频来源**：
- 所有预设音频均来自 [Pixabay](https://pixabay.com/music/) 免费音频库
- 音频采用 Pixabay Content License（免费使用，无需版权费用）
- 在线流式播放，无需下载

**功能特点**：
- 8种预设引导音频
- 播放/暂停/停止控制
- 音量调节
- 自动清理资源
- 支持用户上传自定义音频

### 2. 用户自定义引导音频 ✅

**功能特点**：
- 支持上传本地音频文件（MP3、WAV、OGG等格式）
- 可为不同类型冥想添加专属引导
- 自动分类管理
- 可随时删除自定义音频

### 3. 凯格尔训练 - 多媒体文件支持 ✅

**功能特点**：
- 支持上传视频文件（MP4、WebM等）
- 支持上传图片文件（JPG、PNG、GIF等）
- 训练期间自动循环播放视频
- 图片作为静态背景显示
- 可随时移除或更换媒体文件

## 使用方法

### 冥想引导音频

1. 在冥想计时器页面，点击"引导音频"卡片
2. 展开后可以看到：
   - **✨ 预设引导音频**：8种免费引导音频
   - **📁 上传自定义音频**：上传自己的引导文件
   - **🎵 我的音频库**：已上传的自定义音频
3. 选择想要使用的引导音频
4. 开始冥想时，引导音频会自动播放
5. 可选择"不使用引导音频"，仅使用计时器滴答声

### 凯格尔训练多媒体

1. 在凯格尔训练页面，点击"媒体文件"按钮
2. 选择本地视频或图片文件
3. 文件会自动预览
4. 开始训练时，媒体会在计时器上方显示
5. 视频会自动循环播放

## 技术实现

### 冥想音频服务

```typescript
// 获取所有引导音频（预设 + 用户上传）
const guides = meditationAudioService.getAllGuides()

// 播放引导音频
await meditationAudioService.playGuide(guideId)

// 暂停播放
meditationAudioService.pause()

// 恢复播放
await meditationAudioService.resume()

// 停止播放
meditationAudioService.stop()

// 添加自定义音频
const guide = meditationAudioService.addCustomGuide(file, type, name)

// 删除自定义音频
meditationAudioService.removeCustomGuide(guideId)
```

### 音频播放逻辑

1. **预设音频**：直接使用在线 URL 播放
2. **自定义音频**：使用 `URL.createObjectURL()` 创建本地 Blob URL
3. **播放控制**：引导音频不循环播放，播放完成后自动停止
4. **错误处理**：网络故障或音频加载失败时显示友好提示

## 免费音频资源

### Pixabay Music
- **URL**: https://pixabay.com/music/
- **许可**: Pixabay Content License（免费使用，无需署名）
- **特点**：
  - 大量免费冥想、放松音乐
  - 高质量音频
  - 支持直接链接播放

### 其他免费资源
1. **Freesound**
   - URL: https://freesound.org/
   - 许可: Creative Commons
   - 需注册账号

2. **Zapsplat**
   - URL: https://www.zapsplat.com/
   - 许可: 免费会员可用
   - 需署名

## 注意事项

1. **网络连接**：预设音频需要网络连接才能播放
2. **自动播放限制**：浏览器可能限制自动播放，需要用户交互
3. **音量平衡**：引导音频音量应与提示音协调
4. **错误处理**：网络故障或音频加载失败时的友好提示
5. **音频格式**：用户上传的音频需为常见格式（MP3、WAV、OGG等）

## 测试建议

1. 测试不同网络环境下的音频加载
2. 测试音频播放器的暂停/恢复功能
3. 测试音频播放与计时器的同步
4. 测试多种冥想类型的引导切换
5. 测试移动端兼容性
6. 测试用户上传音频功能

## 更新日志

### v1.2 (2026-01-31)
- ✅ 添加8种预设冥想引导音频
- ✅ 音频来源改为 Pixabay 免费音频库
- ✅ 优化音频选择器UI，区分预设和自定义音频
- ✅ 移除引导音频的循环播放
- ✅ 删除饮食记录功能
